<!DOCTYPE html>
<html>
    <head>
        <title>Demo Chat App</title>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
        
    <body>
        <div class="login">
            <h1>Login</h1>
            <form action="" onsubmit="">
                <label for="email">
                    Email:
                </label>
                <input type="text" name="email" id="email" 
                placeholder="Enter your email" required>
                <label for="password">
                    Password:
                </label>
                <input type="password" name="password" id="password" 
                placeholder="Enter your password" required>
            </form> 
            <div class="wrap">
                <button type="submit" onclick="login(document.getElementById('email').value, document.getElementById('password').value)">
                    Sign in
                </button>
            </div>  
            <p>Not registered?
                <a href="#" style="text-decoration: none;">
                    Create an account
                </a>
            </p>   
        </div>
        <script>
            console.log(localStorage.getItem('jwt'))
            if (localStorage.getItem('jwt') != null) {
                window.location.href = "home";
            }
            function login(email, password) {
                const obj = {
                    "email": email,
                    "password": password
                }
                fetch('http://localhost:8000/api/v1/users/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        //"Access-Control-Allow-Origin": "*"
                    },
                    body: JSON.stringify(obj)
                })
                .then(response => response.json())
                .then(response => {
                        if (response.msg == "OK") {
                            console.log(response.access_token)
                            localStorage.setItem('jwt', response.access_token)
                            window.location.href = "home";
                        } else {
                            alert("Invalid login or password")
                        }
                    }
                )
            }
        </script>
    </body>
</html>